/*!
 * 3DILY v1.0.0
 * (c) 2021-2022 Kamran Mokhtari
 */
var t=function(t,e,n){return Math.min(Math.max(t,e),n)},e=function(){function e(t,e,n,o){this.pointerPosition={x:0,y:0},this.pointerIsDown=!1,this.moved=!1,this.activeIndex=0,this.zoomIsEnable=!1,this.zoomScale=4.3,this.translate={x:0,y:0},this.element=t,this.framesCount=e,this.onChangeFrame=n,this.onZoom=o,this.init()}return e.prototype.init=function(){var e=this;this.element.onpointerdown=function(t){e.pointerPosition={x:t.clientX,y:t.clientY},e.pointerIsDown=!0,e.moved=!1},this.element.onpointermove=function(t){if(e.pointerIsDown&&!e.zoomIsEnable){var n=e.pointerPosition.x-t.clientX;if(!(Math.abs(n)<3)){var o=n<0?e.activeIndex-1:e.activeIndex+1;e.activeIndex=o>e.framesCount-1?0:o<0?e.framesCount-1:o,e.moved=!0,e.onChangeFrame(e.activeIndex),e.pointerPosition={x:t.clientX,y:t.clientY}}}},this.element.onclick=function(t){e.moved||e.zoomIsEnable?e.zoomIsEnable&&(e.zoomIsEnable=!1,e.onZoom("unset")):(e.zoomIsEnable=!0,e.translate=e.getTranslate(t.clientX,t.clientY),e.onZoom("scale(".concat(e.zoomScale,") translate(").concat(e.translate.x,"px, ").concat(e.translate.y,"px)")))},this.element.onpointerup=function(){e.pointerIsDown=!1},this.element.onmousemove=function(t){if(e.zoomIsEnable){var n=e.getTranslate(t.clientX,t.clientY);e.onZoom("scale(".concat(e.zoomScale,") translate(").concat(n.x,"px, ").concat(n.y,"px)"))}},this.element.ontouchmove=function(n){if(e.zoomIsEnable){var o=e.element.clientWidth*(e.zoomScale-1)/(2*e.zoomScale),i=e.element.clientHeight*(e.zoomScale-1)/(2*e.zoomScale),s=n.touches[0].clientX-e.pointerPosition.x,a=n.touches[0].clientY-e.pointerPosition.y;e.pointerPosition={x:n.touches[0].clientX,y:n.touches[0].clientY},e.translate={x:t(e.translate.x+.4*s,-o,o),y:t(e.translate.y+.4*a,-i,i)},e.onZoom("scale(".concat(e.zoomScale,") translate(").concat(e.translate.x,"px, ").concat(e.translate.y,"px)"))}}},e.prototype.getTranslate=function(e,n){var o=t(e-this.element.offsetLeft-parseInt(window.getComputedStyle(this.element).borderWidth.replace("px","")),0,this.element.clientWidth),i=t(n-this.element.offsetTop-parseInt(window.getComputedStyle(this.element).borderWidth.replace("px","")),0,this.element.clientHeight),s=this.element.clientWidth*(this.zoomScale-1)/(2*this.zoomScale),a=this.element.clientHeight*(this.zoomScale-1)/(2*this.zoomScale);return{x:s*(1-2*o/this.element.clientWidth),y:a*(1-2*i/this.element.clientHeight)}},e}(),n=function(){function t(){this.handlers={}}return t.prototype.on=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handlers[t[0]]||(this.handlers[t[0]]=[]),this.handlers[t[0]].push(t[1])},t.prototype.trigger=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handlers[t[0]]||(this.handlers[t[0]]=[]);for(var n=0,o=this.handlers[t[0]];n<o.length;n++){var i=o[n];i(t[1])}},t.prototype.off=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handlers[t[0]]||(this.handlers[t[0]]=[]),t[1]?this.handlers[t[0]]=this.handlers[t[0]].filter((function(e){return e!==t[1]})):this.handlers[t[0]]=[]},t}(),o=function(){function t(t){var o=this;this.activeFrame=0,this.frameElements=[],this.loading=0,this.events=new n,this.zoom=!1,this.onChangeFrame=function(t){o.frameElements[o.activeFrame].classList.remove("threedily-frame-active"),o.frameElements[t].classList.add("threedily-frame-active"),o.activeFrame=t},this.onZoom=function(t){o.frameElements[o.activeFrame].style.transform=t,"unset"===t?(o.zoom=!1,o.frameElements[o.activeFrame].src=o.buildURL(o.activeFrame)):o.zoom||(o.zoom=!0,o.frameElements[o.activeFrame].src=o.buildURL(o.activeFrame,"4k"))},this.onLoading=function(t){void 0===t&&(t=o.loading+1),o.loading=t,o.loading===o.data.framesCount&&(o.controller=new e(o.sceneElement,o.data.framesCount,o.onChangeFrame,o.onZoom),setTimeout((function(){o.progressbar.remove()}),1200)),o.progressbar.firstChild.style.width="".concat(o.loading/o.data.framesCount*100,"%")},this.opts=t,this.validateOpts()?this.init():console.error("opts invalid!")}return t.prototype.init=function(){var t=this;this.container=document.getElementById(this.opts.containerId),this.container?(this.baseUrl="https://dev.api.3dily.com/scene/"+this.opts.panelId+"/"+this.opts.productCode,fetch("".concat(this.baseUrl,"/data")).then((function(t){return t.json()})).then((function(e){t.data=e,t.events.trigger("load-data",e),t.setupScene()}))):console.error("Container not found!")},t.prototype.setupScene=function(){var t=this;if(this.remove(),this.sceneElement=document.createElement("div"),this.sceneElement.classList.add("threedily-scene"),this.container.appendChild(this.sceneElement),this.loading=0,!(this.data.framesCount<1)){this.createLoading();for(var e=0;e<this.data.framesCount;e++){var n=document.createElement("img");n.classList.add("threedily-frame"),e===this.activeFrame&&n.classList.add("threedily-frame-active"),this.sceneElement.appendChild(n),this.frameElements.push(n)}var o=function(e){void 0===e&&(e=0),t.frameElements[e].src=t.buildURL(e),t.frameElements[e].onload=function(){e<t.data.framesCount-1&&o(e+1),t.onLoading(),t.frameElements[e].onload=null}};o()}},t.prototype.createLoading=function(){var t=document.createElement("div");t.classList.add("threedily-linear-progress");var e=document.createElement("div");t.appendChild(e),e.classList.add("threedily-linear-progress-bar"),this.sceneElement.appendChild(t),this.progressbar=t},t.prototype.validateOpts=function(){return this.opts.panelId&&this.opts.containerId&&this.opts.productCode},t.prototype.buildURL=function(t,e){return void 0===e&&(e="2k"),"".concat(this.baseUrl,"/image?frame=").concat(t).concat(!0===this.opts.shadow||void 0===this.opts.shadow?"":"&shadow=false","&size=").concat(JSON.stringify({width:"1k"===e?1024:"2k"===e?1920:3840})).concat(this.opts.variants?"&variants="+JSON.stringify(this.opts.variants):"")},t.prototype.remove=function(){this.frameElements=[],this.container.innerHTML="",this.sceneElement&&this.sceneElement.remove()},t.prototype.changeVariants=function(t){this.opts.variants=t,this.setupScene()},t.prototype.toggleShadow=function(){this.opts.shadow=!this.opts.shadow,this.setupScene()},t.prototype.getData=function(){return this.data},t.prototype.on=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=this.events).on.apply(t,e)},t.prototype.off=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=this.events).off.apply(t,e)},t}();function i(t){return new o(t)}export{i as Threedily};
//# sourceMappingURL=3dily.esm.min.js.map
